{% extends 'base.html' %}
{% load static %}

{% block title %}Gi·ªè h√†ng - TeaZen{% endblock %}

{% block extra_styles %}
<style>
    .font-hand { font-family: 'Reenie Beanie', cursive; }
    
    /* Receipt Style */
    .receipt {
        background: #fff;
        padding: 2rem;
        position: relative;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }
    .receipt::after {
        content: "";
        position: absolute; left: 0; bottom: -10px; width: 100%; height: 20px;
        background: radial-gradient(circle, transparent 70%, #fff 70%) 0 0/20px 20px repeat-x;
        transform: rotate(180deg);
    }
    
    /* Tape effect */
    .tape {
        position: absolute; width: 100px; height: 30px;
        background-color: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(2px);
        border-left: 1px solid rgba(255,255,255,0.8);
        border-right: 1px solid rgba(255,255,255,0.8);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 10;
    }
    
    /* Quantity Input */
    .qty-input {
        width: 60px;
        text-align: center;
        border: 2px solid #e7e5e4;
        padding: 8px;
        font-weight: bold;
    }
    .qty-input:focus {
        border-color: #064e3b;
        outline: none;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- HEADER / NAVIGATION -->
<nav class="fixed top-0 w-full p-6 flex justify-between items-center z-50 mix-blend-difference text-stone-800">
    <a href="{% url 'index' %}" class="hover-trigger font-art text-xl font-bold flex items-center gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i> Ti·∫øp t·ª•c mua s·∫Øm
    </a>
    <div class="font-mono text-xs tracking-widest uppercase">Gi·ªè h√†ng c·ªßa b·∫°n</div>
</nav>

<!-- BACKGROUND DECORATIONS -->
<div class="fixed top-20 right-[10%] text-9xl font-jp font-thin text-stone-200 select-none -z-10 writing-vertical">Ë≤∑Áâ©</div>
<div class="fixed bottom-10 left-[5%] font-art text-[15vw] font-bold text-emerald-900/5 select-none -z-10 leading-none">CART</div>

<!-- MAIN CONTENT -->
<div class="container mx-auto px-6 pt-24 pb-12">
    
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        
        <!-- CART ITEMS -->
        <div class="lg:col-span-8 space-y-8">
            
            <!-- Section Title -->
            <div class="relative">
                <h2 class="font-art text-5xl font-bold text-emerald-950">Gi·ªè h√†ng.</h2>
                <i data-lucide="shopping-bag" class="absolute -top-4 -left-8 w-8 h-8 text-emerald-500 animate-pulse"></i>
            </div>

            {% if cart_items %}
            <!-- Cart Items List -->
            <div class="space-y-6">
                {% for item in cart_items %}
                <div class="relative bg-white p-6 shadow-lg border-l-4 border-emerald-900 flex gap-6 items-center hover-trigger group hover:-translate-y-1 transition-transform">
                    <!-- Product Image -->
                    <div class="w-24 h-24 bg-gray-100 flex-shrink-0 overflow-hidden rounded-lg">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
                        {% else %}
                        <div class="w-full h-full flex items-center justify-center bg-emerald-50">
                            <i data-lucide="leaf" class="w-10 h-10 text-emerald-200"></i>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Product Info -->
                    <div class="flex-grow">
                        <h4 class="font-bold font-art text-xl leading-none">{{ item.product.title }}</h4>
                        <p class="text-xs text-stone-500 mt-1 uppercase tracking-wider">{{ item.product.excerpt|truncatechars:30 }}</p>
                        <div class="font-mono text-emerald-900 mt-2">{{ item.product.price|floatformat:0 }}‚Ç´</div>
                    </div>
                    
                    <!-- Quantity -->
                    <div class="flex items-center gap-2">
                        <form action="{% url 'cart_update' item.product.id %}" method="post" class="flex items-center">
                            {% csrf_token %}
                            <input type="number" name="quantity" value="{{ item.quantity }}" min="0" class="qty-input hover-trigger">
                            <button type="submit" class="ml-2 bg-stone-100 p-2 rounded hover:bg-stone-200 transition-colors hover-trigger">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Subtotal -->
                    <div class="text-right min-w-[100px]">
                        <div class="text-xs text-stone-500 uppercase">T·ªïng</div>
                        <div class="font-mono font-bold text-lg">{{ item.get_subtotal|floatformat:0 }}‚Ç´</div>
                    </div>
                    
                    <!-- Remove Button -->
                    <a href="{% url 'cart_remove' item.product.id %}" class="text-red-500 hover:text-red-700 transition-colors hover-trigger">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </a>
                    
                    <!-- Punch hole effect -->
                    <div class="absolute -right-2 top-1/2 -translate-y-1/2 w-4 h-4 bg-[#f2f0ec] rounded-full shadow-inner"></div>
                </div>
                {% endfor %}
            </div>
            
            {% else %}
            <!-- Empty Cart -->
            <div class="relative group">
                <div class="tape -top-3 left-1/2 -translate-x-1/2 rotate-1"></div>
                <div class="receipt text-center py-16">
                    <i data-lucide="shopping-bag" class="w-24 h-24 mx-auto text-stone-300 mb-4"></i>
                    <h3 class="font-art text-2xl font-bold text-stone-600 mb-2">Gi·ªè h√†ng tr·ªëng</h3>
                    <p class="text-stone-500 mb-6">H√£y kh√°m ph√° v√† th√™m s·∫£n ph·∫©m y√™u th√≠ch v√†o gi·ªè h√†ng!</p>
                    <a href="{% url 'index' %}" class="inline-block bg-emerald-900 text-white font-bold py-3 px-8 uppercase tracking-wider hover:bg-emerald-800 transition-colors hover-trigger">
                        Kh√°m ph√° ngay
                    </a>
                </div>
            </div>
            {% endif %}
            
        </div>
        
        <!-- ORDER SUMMARY -->
        <div class="lg:col-span-4 lg:sticky lg:top-24">
            
            {% if cart_items %}
            <!-- Receipt Summary -->
            <div class="relative group">
                <div class="tape -top-3 left-1/2 -translate-x-1/2 rotate-1"></div>
                <div class="receipt">
                    <div class="text-center border-b-2 border-dashed border-stone-300 pb-4 mb-4">
                        <h3 class="font-mono font-bold text-xl uppercase tracking-widest">T√≥m t·∫Øt ƒë∆°n h√†ng</h3>
                        <p class="text-xs text-stone-500">TeaZen - Premium Tea</p>
                    </div>
                    
                    <div class="space-y-3 font-mono text-sm border-b-2 border-dashed border-stone-300 pb-4 mb-4">
                        {% for item in cart_items %}
                        <div class="flex justify-between">
                            <span class="truncate mr-4">{{ item.product.title }} x{{ item.quantity }}</span>
                            <span>{{ item.get_subtotal|floatformat:0 }}‚Ç´</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="space-y-2 font-mono text-sm">
                        <div class="flex justify-between">
                            <span>T·∫°m t√≠nh</span>
                            <span>{{ cart.get_total_price|floatformat:0 }}‚Ç´</span>
                        </div>
                        <div class="flex justify-between text-stone-500">
                            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                            <span>Mi·ªÖn ph√≠</span>
                        </div>
                    </div>
                    
                    <div class="border-t-2 border-stone-800 mt-4 pt-4">
                        <div class="flex justify-between font-bold text-lg">
                            <span class="font-art">T·ªïng c·ªông</span>
                            <span class="font-mono text-emerald-900">{{ cart.get_total_price|floatformat:0 }}‚Ç´</span>
                        </div>
                    </div>
                    
                    <button class="w-full mt-6 bg-emerald-900 text-white font-bold py-4 uppercase tracking-widest hover:bg-emerald-800 transition-colors hover-trigger">
                        Thanh to√°n
                    </button>
                    
                    <div class="mt-4 text-center">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Barcode.svg/1200px-Barcode.svg.png" class="h-8 mx-auto opacity-40">
                        <p class="text-xs text-stone-400 mt-2 font-mono">{{ cart.get_total_items }} s·∫£n ph·∫©m</p>
                    </div>
                </div>
            </div>
            
            <!-- Promo Note (Post-it) -->
            <div class="bg-[#fff9c4] p-6 shadow-md rotate-2 mt-8 relative">
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-4 h-4 rounded-full bg-red-400 shadow-sm border border-red-500"></div>
                <p class="font-hand text-xl text-stone-700 text-center">
                    üçµ Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn cho ƒë∆°n h√†ng t·ª´ 500.000‚Ç´!
                </p>
            </div>
            {% endif %}
            
        </div>
        
    </div>
</div>
{% endblock %}
